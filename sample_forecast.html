<!DOCTYPE html>
<html>

<head>
    <title>Forecast Form</title>
    <style type="text/css">
        @import url('https://fonts.googleapis.com/css2?family=Jost:wght@100;300;400;700&display=swap');

        body {
            margin: 0px;
            background-color: #f26724;
            color: #f9fcf5;
            font-family: Arial, Helvetica, sans-serif;
        }

        .wrapper {
            width: 400px;
            margin: 40px auto;
            padding: 10px;
            border-radius: 5px;
            background: white;
            box-shadow: 0px 10px 40px 0px rgba(47, 47, 47, .1);
        }

        #survey {
            padding: 10px;
            margin: 10px auto;
            display: block;
            border-radius: 5px;
            border: 1px solid lightgrey;
            background: none;
            width: 274px;
            color: rgb(237, 233, 233);
        }

        #survey:focus {
            outline: none;
        }

        .controls {
            width: 294px;
            margin: 15px auto;
        }

        #remove_fields {
            float: right;
        }

        .controls a i.fa-minus {
            margin-right: 5px;
        }

        a {
            color: black;
            text-decoration: none;
        }

        h1 {
            text-align: center;
            font-size: 48px;
            color: #232c3d;
        }

        body {
            margin: 0px;
            background-color: #f26724;
            color: #f9fcf5;
            font-family: Arial, Helvetica, sans-serif;
        }



        #main {
            width: 800px;
            height: auto;
            overflow: hidden;
            padding-bottom: 20px;
            margin-left: auto;
            margin-right: auto;
            border-radius: 5px;
            padding-left: 10px;
            margin-top: 100px;
            border-top: 3px double #f1f1f1;
            border-bottom: 3px double #f1f1f1;
            padding-top: 20px;
        }

        #main table {
            font-family: "Comic Sans MS", cursive;
        }

        #main .tb,
        .vendorname,
        .cvsname {
            height: 28px;
            width: 250px;
            border: 1px solid #f26724;
            color: #fd7838;
            font-weight: bold;
            border-left: 5px solid #f7f7f7;
            opacity: 0.9;
        }

        #main .tb:focus,
        .vendorname:focus,
        .cvsname:focus {
            height: 28px;
            border: 1px solid #f26724;
            outline: none;
            border-left: 5px solid #f7f7f7;
        }

        #main .btn {
            width: 150px;
            height: 32px;
            outline: none;
            color: #f7f7f7;
            font-weight: bold;
            border: 0px solid #f26724;
            text-shadow: 0px 0.5px 0.5px #fff;
            border-radius: 2px;
            font-weight: 600;
            color: #f26724;
            letter-spacing: 1px;
            font-size: 14px;
            background-color: #f1f1f1;
            -webkit-transition: 1s;
            -moz-transition: 1s;
            transition: 1s;
        }

        #main .btn:hover {
            background-color: #f26724;
            outline: none;
            border-radius: 2px;
            color: #f1f1f1;
            border: 1px solid #f1f1f1;
            -webkit-transition: 1s;
            -moz-transition: 1s;
            transition: 1s;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script>
        function addMorevendorFields() {

            var vendorTeam = document.getElementsByClassName('vendorTeam');
            var tr = document.createElement('tr');
            tr.setAttribute('class', 'vendorTeam');
            var td1 = document.createElement('td');
            tr.appendChild(td1);
            var td2 = document.createElement('td');
            var newField = document.createElement('input');
            newField.setAttribute('type', 'text');
            newField.setAttribute('name', 'vendorname');
            newField.setAttribute('class', 'vendorname');
            newField.setAttribute('placeholder', 'Another Field');
            td2.appendChild(newField);
            tr.appendChild(td2);
            var td3 = document.createElement('td');
            tr.appendChild(td3);
            var td4 = document.createElement('td');
            tr.appendChild(td4);
            vendorTeam[vendorTeam.length - 1].insertAdjacentElement('afterend', tr);
        }


        function removevendorFields() {
            var vendorTeam = document.getElementsByClassName('vendorTeam');
            if (vendorTeam.length > 1) {
                vendorTeam[vendorTeam.length - 1].remove();
            }
        }

        function addMorecvsFields() {

            var cvsTeam = document.getElementsByClassName('cvsTeam');
            var tr = document.createElement('tr');
            tr.setAttribute('class', 'cvsTeam');
            var td1 = document.createElement('td');
            tr.appendChild(td1);
            var td2 = document.createElement('td');
            var newField = document.createElement('input');
            newField.setAttribute('type', 'text');
            newField.setAttribute('name', 'cvsname');
            newField.setAttribute('class', 'cvsname');
            newField.setAttribute('placeholder', 'Another Field');
            td2.appendChild(newField);
            tr.appendChild(td2);
            var td3 = document.createElement('td');
            tr.appendChild(td3);
            var td4 = document.createElement('td');
            tr.appendChild(td4);
            cvsTeam[cvsTeam.length - 1].insertAdjacentElement('afterend', tr);


        }

        function removecvsFields() {
            var cvsTeam = document.getElementsByClassName('cvsTeam');
            if (cvsTeam.length > 1) {
                cvsTeam[cvsTeam.length - 1].remove();
            }
        }

        function checkFile(sender, validExts) {
            var fileExt = sender.value;
            fileExt = fileExt.substring(fileExt.lastIndexOf('.'));
            if (validExts.indexOf(fileExt) < 0 && fileExt != "") {
                alert("Invalid file selected, valid files are of " + validExts.toString() + " types.");
                $(sender).val("");
                return false;
            }
            else return true;
        }

        function submitForm() {
        const sheetName = document.getElementById("sheetName").value;
        const costCenter = document.getElementById("costCenter").value;
        const startDate = document.getElementById("startDate").value;
        const endDate = document.getElementById("endDate").value;

        const vendorTeam = [];
        const vendorTeamInputs = document.getElementsByClassName("vendorname");
        for (let i = 0; i < vendorTeamInputs.length; i++) {
          vendorTeam.push(vendorTeamInputs[i].value);
        }

        const cvsTeam = [];
        const cvsTeamInputs = document.getElementsByClassName("cvsname");
        for (let i = 0; i < cvsTeamInputs.length; i++) {
          cvsTeam.push(cvsTeamInputs[i].value);
        }

        const filters = {
          sheetName,
          costCenter,
          startDate,
          endDate,
          vendorTeam,
          cvsTeam,
        };

        const formData = new FormData();
        formData.append("forecast_file", document.getElementById("upload_file").files[0]);
        formData.append("filters", JSON.stringify(filters));

        // const xhr = new XMLHttpRequest();
        // xhr.open("POST", "http://localhost:8080/api/v1.0/createWordFile", true);
        // xhr.send(formData);
      
        const xhr = new XMLHttpRequest();
xhr.open("POST", "http://localhost:8080/api/v1.0/createWordFile", true);
xhr.responseType = "blob";

xhr.onload = function(event) {
  if (xhr.status === 200) {
    const blob = xhr.response;
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "SOW_Document.docx";
    link.click();
  }
//   if(xhr.status === 400){
//     window.alert("Date dose not match with date in excel!!!");
//   }
};

xhr.send(formData);

    
    }

        

    </script>

</head>

<body>

    <form>
        <div id="main">
            <h2>
                <center>Forecast Details Form</center>
            </h2>
            <div class="login">
                <table cellspacing="2" align="center" cellpadding="8" border="0">

                    <tr>
                        <td align="right"><label for="sheetName">Sheet Name :</label></td>
                        <td><input type="text" name="sheetName" id="sheetName" class="tb" required /></td>
                    </tr>
                    
                    <tr>
                        <td align="right"><label for="costcenter">Cost center :</label></td>
                        <td><input type="text" name="costcenter" id="costCenter" class="tb" required /></td>
                    </tr>

                    <tr>
                        <td align="right"><label for="startdate">StartDate :</label></td>
                        <td><input type="date" name="startdate" id="startDate" class="tb" required /></td>
                    </tr>

                    <tr>
                        <td align="right"><label for="enddate">EndDate :</label></td>
                        <td><input type="date" name="enddate" id="endDate" class="tb" required /></td>
                    </tr>

                    <tr class="vendorTeam">
                        <td align="right"><label for="vendorname">Vendor name :</label></td>
                        <td><input type="text" name="vendorname" id="vendor" class="vendorname" placeholder="Name"
                                required /> </td>

                        <td><a href="#" id="add_more_vendor_fields" onclick="addMorevendorFields()"><i
                                    class="fas fa-plus"></i>+Add</a></td>
                        <td><a href="#" id="remove_vendor_fields" onclick="removevendorFields()"><i
                                    class="fas fa-plus"></i>-Remove</a></td>


                    </tr>

                    <tr class="cvsTeam">
                        <td align="right"><label for="cvsname">Cvs Project name :</label></td>
                        <td><input type="text" name="cvsname" id="cvs" class="cvsname" placeholder="Name" required />
                        </td>

                        <td><a href="#" id="add_more_cvs_fields" onclick="addMorecvsFields()"><i
                                    class="fas fa-plus"></i>+Add</a></td>
                        <td><a href="#" id="remove_cvs_fields" onclick="removecvsFields()"><i
                                    class="fas fa-plus"></i>-Remove</a></td>


                    </tr>
                    <tr>
                        <td align="right">Select file to upload :</td>
                        <td><input id="upload_file" accept=".xls,.xlsx,.csv," name="forecastFile" type="file" required />
                        </td>
                    </tr>


                    <tr>
                        <td></td>
                        <td>
                            <button type="button" onclick="submitForm()">Submit</button>
                        </td>
                    </tr>




                </table>
            </div>
        </div>
    </form>
</body>

</html>